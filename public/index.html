<html>

<head>
  <title>Touch My Hand</title>
  <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
  <script src="easyrtc/easyrtc.js"></script>
  <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
</head>

<body style="background-color: black">
  <script>
      AFRAME.registerComponent('rotate-world', {
        init() {
          this.el.addEventListener('abuttondown', () => {
            this.rotate();
          });
        },
        rotate() {
          const world = document.getElementById('world');
          const head = document.getElementById('head');
          const x = head.object3D.position.x;
          const z = head.object3D.position.z;

          world.object3D.rotation.set(
            0,
            Math.atan2(x, z) - Math.PI * 3,
            0,
          );
        },
      });

      AFRAME.registerComponent('x-button-listener', {
        init: function () {
          var el = this.el;
          el.addEventListener('xbuttondown', function (evt) {
            el.setAttribute('visible', !el.getAttribute('visible'));
          });
        }
      });
    </script>
  <a-scene networked-scene animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
    <a-assets>
      <template id="head-template">
        <a-box color="yellow" scale=".4 .4 .4"></a-box>
      </template>
      <template id="left-hand-template">
        <a-box color="yellow" height=".05" depth=".05" width=".05"></a-box>
      </template>
      <template id="right-hand-template">
        <a-box color="yellow" height=".05" depth=".05" width=".05"></a-box>
      </template>
    </a-assets>
    <a-entity environment="preset: tron; ground: none"></a-entity>
    <a-entity id="player">

      <a-entity camera id="head" wasd-controls="fly: true" look-controls
        networked="template:#head-template;attachTemplateToLocal:false;"></a-entity>
      <a-entity oculus-touch-controls="hand: left" rotate-world networked="template:#left-hand-template">
        <a-box color="yellow" height=".05" depth=".05" width=".05"></a-box>
      </a-entity>
      <a-entity oculus-touch-controls="hand: right" rotate-world networked="template:#right-hand-template">
        <a-box color="yellow" height=".05" depth=".05" width=".05"></a-box>
      </a-entity>
    </a-entity>
    <a-entity id="world">
        <a-box height=".05" position="-11 0 -25.5" material="" color="green" geometry="width:22;depth:51"></a-box>
    </a-entity>

    <a-entity position="0 -1 0" visible="false">
        <a-box height=".05" position="-0.5 0 -0.5" material="" color="green"></a-box>
        <a-box height=".05" position="0.5 0 0.5" material="" color="yellow"></a-box>
        <a-box height=".05" position="0.5 0 -0.5" material="" color="red"></a-box>
        <a-box height=".05" position="-0.5 0 0.5" material="" color="blue"></a-box>
    </a-entity>
    <!-- <a-box width=".9" depth=".05" height="2" position="0 1 0"></a-box> -->
  </a-scene>
</body>

</html>
